var Index=function(){const csrf_token=$('meta[name="csrf-token"]').attr("content"),costCenterid=$("#cost-center").val();var table,aSelected=[],handleData=function(){table=$("#table-cost-center-department").DataTable({responsive:!0,autoWidth:!0,pageLength:15,searching:!0,paging:!0,lengthMenu:[[15,25,50],[15,25,50]],language:{info:"Show _START_ - _END_ from _TOTAL_ data",infoEmpty:"Show 0 - 0 from 0 data",infoFiltered:"",zeroRecords:"Data not found",loadingRecords:"Loading...",processing:"Processing..."},columnsDefs:[{searchable:!1,target:[0,1]},{orderable:!1,target:0}],processing:!0,serverSide:!0,ajax:{url:url+"app/flexy-allowance/cost-center-department-route.php",type:"POST",data:{_token:csrf_token,action:"get-data",costcenter:costCenterid}},columns:[{data:"cbox",orderable:!1},{data:"rnum",orderable:!1},{data:"comcost",orderable:!1},{data:"department",orderable:!1}],drawCallback:function(settings){$(".data-menu-cbox").on("click",(function(){handleAddDeleteAselected($(this).val(),$(this).parents()[1])})),$("#btn-delete").attr("disabled",""),aSelected.splice(0,aSelected.length)}})},handleAddDeleteAselected=function(value,parentElement){var check_value=$.inArray(value,aSelected);-1!==check_value?($(parentElement).removeClass("table-info"),aSelected.splice(check_value,1)):($(parentElement).addClass("table-info"),aSelected.push(value)),handleBtnDisableEnable()},handleBtnDisableEnable=function(){aSelected.length>0?$("#btn-delete").removeAttr("disabled"):$("#btn-delete").attr("disabled","")},handleDelete=function(){$("#btn-delete").click((function(e){e.preventDefault(),Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(result=>{result.isConfirmed&&$.ajax({type:"POST",url:url+"app/flexy-allowance/cost-center-department-route.php",data:{_token:csrf_token,ids:aSelected,action:"delete"},success:function(response){1==response.success&&(Swal.fire("Deleted!","Your data has been deleted.","success"),table.ajax.reload())},error:function(response){Swal.fire({icon:"error",title:"Oops...",text:"Internal Server Error"})}})})}))},handleSave=function(){$("#btnBack").click((function(e){e.preventDefault(),window.location.href=url+"view/admin-flexy/cost-center-index.php"})),$("#form-add-cost-center-department").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);formData.append("action","save"),confirm("All done?!")&&$.ajax({type:"POST",url:url+"app/flexy-allowance/cost-center-department-route.php",data:formData,processData:!1,contentType:!1,success:function(response){let obj;!0===response.success&&(toastr.success(response.data),setTimeout(()=>{location.reload()},3500))},error:function(response){$.each(response.responseJSON.data,(function(key,value){toastr.error(value)}))}})}))},handleDetailCostCenter=function(){$.ajax({type:"post",url:url+"app/flexy-allowance/cost-center-route.php",data:{costcenter:costCenterid,action:"detail",_token:csrf_token},dataType:"json",success:function(response){$("#company-detail").val(response.company_name),$("#cost-center-detail").val(response.cost_center_name)}})},handleDataDepartemen=function(){$("#department").select2({allowClear:!0,placeholder:"select department/type department name",dataType:"json",ajax:{method:"POST",url:url+"app/ajax/data-departemen-dropdown.php",data:function(params){return{search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!1}}}},templateResult:format,templateSelection:formatSelection})};function format(repo){if(repo.loading)return repo.text;var $container=$("<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'></div></div>");return $container.find(".select2-result-repository__title").text(repo.text),$container}function formatSelection(repo){return repo.text}return{init:function(){handleData(),handleDelete(),handleDetailCostCenter(),handleDataDepartemen(),handleSave()}}}();$(document).ready((function(){Index.init()}));