var Index=function(){const csrf_token=$('meta[name="csrf-token"]').attr("content");var handleSubmitAllowance=function(){$("#form-add-user-wallet").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);confirm("Apakah data sudah sesuai?")&&$.ajax({type:"POST",url:url+"app/flexy-allowance/allowance-request-submit.php",data:formData,processData:!1,contentType:!1,success:function(response){toastr.success(response.data),setTimeout(()=>{window.location.href=url+"/view/flexy-allowance/allowance-detail.php?detail="+response.content},3500)},error:function(response){$.each(response.responseJSON.data,(function(key,value){toastr.error(value)})),handleAllowanceNumber()}})}))},handleAllowanceNumber=function(){$.ajax({type:"post",url:url+"app/flexy-allowance/allowance-request-callback.php",data:{_token:csrf_token},dataType:"json",success:function(response){$("#nomer-allowance").val(response.newAllowanceNo)}})},handleDropdownCompany=function(){$("#company").select2({allowClear:!0,placeholder:"Select company/Type company name",dataType:"json",ajax:{method:"POST",url:url+"app/ajax/data-company-dropdown.php",data:function(params){return{_token:csrf_token,search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!1}}}},templateResult:format,templateSelection:formatSelection}),getCostCenter()},handleResetCompanydropdwon=function(){$("#company").on("select2:unselecting",(function(e){$("#cost-center").empty(),$("#department").empty(),toastr.success("reset selection success"),$("#cost-center").select2({placeholder:"Select cost center/Type cost center name"}),$("#department").select2({placeholder:"Select department/Type department name"})}))};function format(repo){if(repo.loading)return repo.text;var $container=$("<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'></div></div>");return $container.find(".select2-result-repository__title").text(repo.text),$container}function formatSelection(repo){return repo.text}var getCostCenter=function(){$("#company").change((function(e){e.preventDefault();const companyId=$(this).val();$.ajax({type:"post",url:url+"app/flexy-allowance/allowance-request-route.php",data:{company:companyId,_token:csrf_token,action:"get-cost-center"},dataType:"json",success:function(response){const responseValue=response.item;arraysEqual(responseValue,$("#cost-center").select2())||($("#cost-center").empty(),$("#cost-center").select2({data:responseValue})),getCostCenterDepartment()}})}))},getCostCenterDepartment=function(){$("#cost-center").change((function(e){e.preventDefault();const costCenterId=$(this).val();$.ajax({type:"post",url:url+"app/flexy-allowance/allowance-request-route.php",data:{costcenter:costCenterId,_token:csrf_token,action:"get-cost-center-department"},dataType:"json",success:function(response){const responseValue=response.item;arraysEqual(responseValue,$("#department").select2())||($("#department").empty(),$("#department").select2({data:responseValue}))}})}))};function arraysEqual(arr1,arr2){if(arr1.length!==arr2.length)return!1;for(var i=0;i<arr1.length;i++)if(arr1[i].id!==arr2[i].id||arr1[i].text!==arr2[i].text)return!1;return!0}var handleSelect2=function(){$("#cost-center").select2({placeholder:"Select cost center/Type cost center name"}),$("#department").select2({placeholder:"Select department/Type department name"})};return{init:function(){handleSubmitAllowance(),handleAllowanceNumber(),handleDropdownCompany(),handleSelect2(),handleResetCompanydropdwon()}}}();$(document).ready((function(){Index.init()}));