var Index=function(){const csrf_token=$('meta[name="csrf-token"]').attr("content");var getEditAllowance=function(){$.ajax({type:"POST",url:url+"app/flexy-allowance/allowance-request-route.php",data:{_token:csrf_token,action:"edit",nomer:noAllowance},dataType:"json",success:function(response){$("#formValue").val(response.allowance),$("#nomer-allowance").val(response.nomer),$("#transaction-date").val(response.transaction_date),$("#request-allowance").val(response.subject),$("#periode").append($("<option>",{value:response.period,text:response.period,attr:"selected"})),$("#company").append($("<option>",{value:response.company,text:response.company_name,attr:"selected"})),$("#cost-center").append($("<option>",{value:response.cost_center,text:response.cost_center_name,attr:"selected"})),$("#department").append($("<option>",{value:response.dept,text:response.dept_name,attr:"selected"}))}})},handleUpdateAllowance=function(){$("#form-edit-user-wallet").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);formData.append("action","update"),confirm("Is it correct?")&&$.ajax({type:"POST",url:url+"app/flexy-allowance/allowance-request-route.php",data:formData,processData:!1,contentType:!1,success:function(response){toastr.success(response.data),setTimeout(()=>{window.location.href=url+"view/flexy-allowance/allowance-user-index.php"},3500)},error:function(response){$.each(response.responseJSON.data,(function(key,value){toastr.error(value)}))}})}))},handleDropdownCompany=function(){$("#company").select2({allowClear:!0,placeholder:"Select company/Type company name",dataType:"json",ajax:{method:"POST",url:url+"app/ajax/data-company-dropdown.php",data:function(params){return{_token:csrf_token,search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!1}}}},templateResult:format,templateSelection:formatSelection}),getCostCenter()},handleResetCompanydropdwon=function(){$("#company").on("select2:unselecting",(function(e){$("#cost-center").empty(),$("#department").empty(),toastr.success("reset selection success"),$("#cost-center").select2({placeholder:"Select cost center/Type cost center name"}),$("#department").select2({placeholder:"Select department/Type department name"})}))};function format(repo){if(repo.loading)return repo.text;var $container=$("<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'></div></div>");return $container.find(".select2-result-repository__title").text(repo.text),$container}function formatSelection(repo){return repo.text}var getCostCenter=function(){$("#company").change((function(e){$("#cost-center").empty(),$("#department").empty(),$("#cost-center").select2({placeholder:"Select cost center/Type cost center name"}),$("#department").select2({placeholder:"Select department/Type department name"}),e.preventDefault();const companyId=$(this).val();$.ajax({type:"post",url:url+"app/flexy-allowance/allowance-request-route.php",data:{company:companyId,_token:csrf_token,action:"get-cost-center"},dataType:"json",success:function(response){const responseValue=response.item;arraysEqual(responseValue,$("#cost-center").select2())||($("#cost-center").empty(),$("#cost-center").select2({data:responseValue})),getCostCenterDepartment()}})}))},getCostCenterDepartment=function(){$("#cost-center").change((function(e){e.preventDefault();const costCenterId=$(this).val();$.ajax({type:"post",url:url+"app/flexy-allowance/allowance-request-route.php",data:{costcenter:costCenterId,_token:csrf_token,action:"get-cost-center-department"},dataType:"json",success:function(response){const responseValue=response.item;arraysEqual(responseValue,$("#department").select2())||($("#department").empty(),$("#department").select2({data:responseValue}))}})}))};function arraysEqual(arr1,arr2){if(arr1.length!==arr2.length)return!1;for(var i=0;i<arr1.length;i++)if(arr1[i].id!==arr2[i].id||arr1[i].text!==arr2[i].text)return!1;return!0}var handleSelect2=function(){$("#cost-center").select2({placeholder:"Select cost center/Type cost center name"}),$("#department").select2({placeholder:"Select department/Type department name"})},handlePeriodEdit=function(){for(var dataPeriod=[],currentYear=(new Date).getFullYear(),index=currentYear;index<=currentYear;index++)var yearLoop=dataPeriod.push({id:index,text:index});$("#periode").select2({data:dataPeriod})};return{init:function(){handleUpdateAllowance(),handleDropdownCompany(),handleSelect2(),handleResetCompanydropdwon(),getEditAllowance(),handlePeriodEdit()}}}();$(document).ready((function(){Index.init()}));