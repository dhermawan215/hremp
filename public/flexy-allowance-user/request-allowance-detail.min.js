var Index=function(){const csrf_token=$('meta[name="csrf-token"]').attr("content");var getDetailAllowance=function(){$.ajax({type:"post",url:url+"app/flexy-allowance/allowance-request-detail-route.php",data:{nomer:noAllowance,_token:csrf_token,action:"get-detail-allowance"},dataType:"json",success:function(response){$("#request-id").html(response.nomer),$("#req-date").html(response.transaction_date),$("#req-name").html(response.name),$("#subject").val(response.nama),$("#cost-center").val(response.cost_center_name),$("#department").val(response.dept_name),$("#period").val(response.period),$("#allowance-number").val(response.allowance)}})},handleActivity=function(){$("#activity").select2({allowClear:!0,placeholder:"Select Activity",dataType:"json",ajax:{method:"POST",url:url+"app/flexy-allowance/allowance-request-detail-route.php",data:function(params){return{_token:csrf_token,action:"get-activity",search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!1}}}},templateResult:format,templateSelection:formatSelection}),getDetailActivity()},handleResetActivityDropdown=function(){$("#activity").on("select2:unselecting",(function(e){$("#detail-activity").empty(),$("#deskripsi").val(""),toastr.success("reset selection success"),$("#detail-activity").select2({placeholder:"Select Detail Activity"})}))};function format(repo){if(repo.loading)return repo.text;var $container=$("<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'></div></div>");return $container.find(".select2-result-repository__title").text(repo.text),$container}function formatSelection(repo){return repo.text}var getDetailActivity=function(){$("#activity").change((function(e){e.preventDefault();const activityId=$(this).val();$.ajax({type:"post",url:url+"app/flexy-allowance/allowance-request-detail-route.php",data:{activity:activityId,_token:csrf_token,action:"get-activity-detail"},dataType:"json",success:function(response){const responseValue=response.item;arraysEqual(responseValue,$("#detail-activity").select2())||($("#detail-activity").empty(),$("#deskripsi").val(""),$("#detail-activity").select2({data:responseValue})),handleFillDescription()}})}))};function arraysEqual(arr1,arr2){if(arr1.length!==arr2.length)return!1;for(var i=0;i<arr1.length;i++)if(arr1[i].id!==arr2[i].id||arr1[i].text!==arr2[i].text)return!1;return!0}var handleFillDescription=function(){$("#detail-activity").change((function(e){e.preventDefault();const selectedText=$("#detail-activity").find(":selected").text();$("#deskripsi").val(selectedText)}))},handleClaimAmount=function(){var hasilLimit=$.ajax({type:"post",async:!1,url:url+"app/flexy-allowance/limit-statistik2.php",data:{_token:csrf_token},dataType:"json",success:function(response){var limitData;return{limit:response.limit,remain:response.remain}}});const userLimit=hasilLimit.responseJSON.limit,userRemainBalance=hasilLimit.responseJSON.remain;$("#jumlah-biaya-bon").on("keyup change",(function(){""===$(this).val()?$("#jumlah-biaya-klaim").prop("readonly",!0):$("#jumlah-biaya-klaim").prop("readonly",!1)})),$("#jumlah-biaya-klaim").on("keyup",(function(){const claimAmount=$("#jumlah-biaya-klaim").val(),intClaimAmount=parseInt(claimAmount),intUserRemain=parseInt(userRemainBalance),intUserLimit=parseInt(userLimit);intClaimAmount>intUserRemain?($("#valid-invalid-biaya-klaim").html("insufficient balance!"),toastr.error("insufficient balance!"),$("#jumlah-biaya-klaim").addClass("is-invalid"),$("#btn-save-detail").attr("disabled","disabled")):($("#jumlah-biaya-klaim").removeClass("is-invalid"),$("#btn-save-detail").removeAttr("disabled"))}))},handleSelect2=function(){$("#detail-activity").select2({placeholder:"Select/Type Detail Activity"})};return{init:function(){handleSelect2(),handleActivity(),handleResetActivityDropdown(),handleSelect2(),handleClaimAmount(),getDetailAllowance()}}}();$(document).ready((function(){Index.init()}));